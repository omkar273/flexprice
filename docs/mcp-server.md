# FlexPrice MCP Server

The FlexPrice MCP (Model Context Protocol) server exposes your FlexPrice REST API as **MCP tools** so AI assistants (Cursor, Claude Desktop, etc.) can call your API without reading REST docs. One tool is generated per OpenAPI operation; the server proxies tool calls to your API with your API key.

---

## Table of contents

- [Overview](#overview)
- [Prerequisites](#prerequisites)
- [Build](#build)
- [Configuration](#configuration)
- [Running standalone](#running-standalone)
- [Cursor setup](#cursor-setup)
- [Claude Desktop setup](#claude-desktop-setup)
- [Troubleshooting](#troubleshooting)
- [Security](#security)

---

## Overview

- **What it does:** Loads the FlexPrice OpenAPI 3 spec (`swagger-3-0.json`), generates one MCP tool per API operation (e.g. `get_customers`, `post_subscriptions`), and forwards each tool call as an HTTP request to your FlexPrice API with `x-api-key` auth.
- **No duplication:** The OpenAPI spec is the single source of truth; tool names and schemas are derived from it.
- **Auth:** All requests use the API key you provide via environment variables.

---

## Prerequisites

- **Go 1.23+** (to build the server)
- **FlexPrice API key** (from your FlexPrice dashboard or config)
- **OpenAPI spec:** `docs/swagger/swagger-3-0.json` (generated by `make swagger` in this repo)

---

## Build

From the **repository root**:

```bash
go build -o flexprice-mcp ./cmd/mcp-server/
```

This produces the `flexprice-mcp` binary in the current directory.

**Optional: install to a path without spaces** (recommended for Cursor/Claude to avoid spawn errors):

```bash
mkdir -p "$HOME/bin"
cp flexprice-mcp "$HOME/bin/flexprice-mcp"
chmod +x "$HOME/bin/flexprice-mcp"
```

Use `/Users/<you>/bin/flexprice-mcp` (or `$HOME/bin/flexprice-mcp`) as the `command` in MCP configs.

---

## Configuration

The server is configured **only via environment variables** (no config file).

| Variable | Required | Description |
|----------|----------|-------------|
| `FLEXPRICE_BASE_URL` | Yes* | Base URL of the FlexPrice API (e.g. `http://localhost:8080`, `https://api-dev.cloud.flexprice.io`). *Can use `BASE_URL` instead. |
| `FLEXPRICE_API_KEY` | Yes* | API key sent as `x-api-key` on every request. *Can use `API_KEY` instead. |
| `FLEXPRICE_OPENAPI_SPEC` | No | Path to OpenAPI 3 JSON spec. Default: `docs/swagger/swagger-3-0.json` (relative to current working directory). **Use an absolute path** when the server is started from a different directory (e.g. by Cursor or Claude). |

**Example (absolute spec path for use with Cursor/Claude):**

```bash
export FLEXPRICE_BASE_URL="https://api-dev.cloud.flexprice.io"
export FLEXPRICE_API_KEY="sk_your_api_key_here"
export FLEXPRICE_OPENAPI_SPEC="/path/to/flexprice/docs/swagger/swagger-3-0.json"
./flexprice-mcp
```

---

## Running standalone

To test the server manually (stdio JSON-RPC):

```bash
cd /path/to/flexprice
export FLEXPRICE_BASE_URL="http://localhost:8080"
export FLEXPRICE_API_KEY="your-api-key"
export FLEXPRICE_OPENAPI_SPEC="$(pwd)/docs/swagger/swagger-3-0.json"
./flexprice-mcp
```

Then connect an MCP client (e.g. [MCP Inspector](https://github.com/modelcontextprotocol/inspector)) or send JSON-RPC over stdin. The server expects an MCP handshake (e.g. `initialize` then `tools/list`); raw `tools/list` without initialize will return an error.

---

## Cursor setup

1. **Build and optionally install the binary** (see [Build](#build)). Use a path **without spaces** (e.g. `$HOME/bin/flexprice-mcp`) so Cursor can spawn it without `EACCES` / path-splitting issues.

2. **Open Cursor MCP settings**  
   - **Cursor → Settings → MCP** (or **Features → MCP**), or  
   - **Cmd + Shift + P** → “Cursor Settings” → find MCP.

3. **Add the FlexPrice MCP server**  
   Use the **exact path** to the binary (no placeholder like `/absolute/path/to/...`). Example:

   ```json
   {
     "mcpServers": {
       "flexprice": {
         "command": "/Users/omkar/bin/flexprice-mcp",
         "env": {
           "FLEXPRICE_BASE_URL": "https://api-dev.cloud.flexprice.io",
           "FLEXPRICE_API_KEY": "sk_your_api_key",
           "FLEXPRICE_OPENAPI_SPEC": "/Users/omkar/Developer/source code/flexprice/flexprice/docs/swagger/swagger-3-0.json"
         }
       }
     }
   }
   ```

4. **Save and restart Cursor** (or **Developer: Reload Window**).

5. **Use in chat**  
   Ask the AI to use your API, e.g. “List my customers”, “Create a subscription”, “Get plan by id …”. Tools are named after operations (e.g. `get_customers`, `post_subscriptions`), not “FlexPrice” literally.

**Important:** If your repo path contains spaces (e.g. `source code`), **do not** use that path as `command`; use a path without spaces (e.g. `$HOME/bin/flexprice-mcp`).

---

## Claude Desktop setup

1. **Locate the config file**  
   Claude Desktop reads **only** this file:
   - **macOS:** `~/Library/Application Support/Claude/claude_desktop_config.json`
   - **Windows:** `%APPDATA%\Claude\claude_desktop_config.json`

   Because of the space in “Application Support”, use quotes and `$HOME` in the shell:
   ```bash
   cat "$HOME/Library/Application Support/Claude/claude_desktop_config.json"
   ```

2. **Open the config in an editor**
   ```bash
   cursor "$HOME/Library/Application Support/Claude/claude_desktop_config.json"
   ```
   or:
   ```bash
   open "$HOME/Library/Application Support/Claude/claude_desktop_config.json"
   ```

3. **Add the FlexPrice MCP server**  
   Merge the `mcpServers` block with any existing config (e.g. `preferences`). Example:

   ```json
   {
     "preferences": {
       "sidebarMode": "chat",
       "coworkScheduledTasksEnabled": false
     },
     "mcpServers": {
       "flexprice": {
         "command": "/Users/omkar/bin/flexprice-mcp",
         "env": {
           "FLEXPRICE_BASE_URL": "https://api-dev.cloud.flexprice.io",
           "FLEXPRICE_API_KEY": "sk_your_api_key",
           "FLEXPRICE_OPENAPI_SPEC": "/Users/omkar/Developer/source code/flexprice/flexprice/docs/swagger/swagger-3-0.json"
         }
       }
     }
   }
   ```

4. **Save the file and fully quit Claude Desktop** (e.g. Cmd+Q), then open it again.

5. **Use in a new chat**  
   Ask e.g. “List my customers” or “Use your tools to get subscriptions.” Claude will use the FlexPrice MCP tools when connected.

**Warning:** Editing a file inside your repo (e.g. `flexprice/Support/Claude/claude_desktop_config.json`) does **not** affect Claude Desktop. You must edit the file under `~/Library/Application Support/Claude/` (macOS) or the Windows path above. To copy from repo to the real config:
```bash
cp "/path/to/flexprice/Support/Claude/claude_desktop_config.json" "$HOME/Library/Application Support/Claude/claude_desktop_config.json"
```

---

## Troubleshooting

| Symptom | Cause | Fix |
|--------|--------|-----|
| `spawn ... ENOENT` | Cursor/Claude tried to run a path that doesn’t exist (e.g. placeholder `/absolute/path/to/flexprice/flexprice-mcp`). | Set `command` to the **real** path to `flexprice-mcp` (e.g. `$HOME/bin/flexprice-mcp` or full path). |
| `spawn ... EACCES` | Often: path contains a **space** (e.g. `.../source code/.../flexprice-mcp`), so the host splits the command and tries to execute a directory. | Use a path **without spaces** (e.g. copy binary to `~/bin`: `cp flexprice-mcp "$HOME/bin/flexprice-mcp"` and use `"command": "/Users/you/bin/flexprice-mcp"`). |
| `FLEXPRICE_BASE_URL or BASE_URL is required` | Server started without base URL (e.g. run from terminal without env). | When running by hand, set env vars. When using Cursor/Claude, ensure the `env` block in config includes `FLEXPRICE_BASE_URL`. |
| `open docs/swagger/swagger-3-0.json: no such file or directory` | Working directory is not the repo root, so the default relative spec path doesn’t exist. | Set `FLEXPRICE_OPENAPI_SPEC` to the **absolute** path to `docs/swagger/swagger-3-0.json` in your `env` config. |
| “No server info found” / “Server not yet created” | MCP server didn’t start (wrong `command`, ENOENT/EACCES, or config not in the right place). | Fix `command` and path-with-spaces as above; ensure config is the one Cursor/Claude actually reads (see Cursor/Claude sections). Restart the app. |
| API returns **404** on valid-looking requests | (1) Missing **environment scope** (FlexPrice may require `X-Environment-ID`). (2) Resource doesn’t exist in that tenant/environment. (3) Wrong base URL. | Use the correct `FLEXPRICE_BASE_URL` for your environment. If your FlexPrice account uses environments, you may need to pass an environment ID (future: `FLEXPRICE_ENVIRONMENT_ID` support). Confirm the resource exists (e.g. in dashboard). |

---

## Security

- **Do not commit API keys.** Keep `FLEXPRICE_API_KEY` only in local config (Cursor/Claude MCP `env`) or environment, not in the repo.
- **Rotate keys** if a key is ever committed or exposed.
- The MCP server sends the API key on every request to your FlexPrice API; use the same key and scoping (tenant/environment) as you would for normal API or SDK usage.

---

## Summary

| Step | Action |
|------|--------|
| 1 | Build: `go build -o flexprice-mcp ./cmd/mcp-server/` |
| 2 | (Recommended) Copy to path without spaces: `cp flexprice-mcp "$HOME/bin/flexprice-mcp"` |
| 3 | Set env: `FLEXPRICE_BASE_URL`, `FLEXPRICE_API_KEY`, `FLEXPRICE_OPENAPI_SPEC` (absolute path when not run from repo root) |
| 4 | Add MCP server to **Cursor** or **Claude Desktop** config with that `command` and `env` |
| 5 | Use the **correct config file** (Cursor: in-app MCP settings; Claude: `~/Library/Application Support/Claude/claude_desktop_config.json` on macOS) |
| 6 | Restart the app and use chat to invoke FlexPrice API via the MCP tools |
